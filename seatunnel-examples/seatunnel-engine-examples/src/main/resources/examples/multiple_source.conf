env {
    parallelism = 1
    job.name = ad_account_sync
    job.mode = BATCH
}

source {
    Jdbc {
        url = "jdbc:mysql://10.35.2.110:33016/sunrise?allowMultiQueries=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false&rewriteBatchedStatements=true&useSSL=false"
        user = "repl"
        password = "RePl#123"
        driver = "com.mysql.cj.jdbc.Driver"
        query = "select company_id AS company_id, CAST(account_id AS char) AS account_id, name as account_name, simple_name as simple_name, '' as manger_account_id, if(channel_type = 'FEED',10008,10009 )  AS media_id, '' as media_company_name, if(status in ('ENABLE', 'INITIALIZING'), 'SUCCESS', 'FAIL') as auth_status, token     as certificate, '' as media_auth_account, create_time as auth_time, -1 as agent_id, optimizer_id, -1 as app_id, create_by as auth_user_id, if(child_account =1,0,1 ) AS is_manger_account, 0 as is_deleted from sunrise.uc_account where channel_type is not null and channel_type != ''"
        connection_check_timeout_sec = 100
        result_table_name = tb00
    }
    Jdbc {
        url = "jdbc:mysql://10.35.2.110:33016/sunrise?allowMultiQueries=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false&rewriteBatchedStatements=true&useSSL=false"
        user = "repl"
        password = "RePl#123"
        driver = "com.mysql.cj.jdbc.Driver"
        query = "select company_id AS company_id, CAST(account_id AS char) AS account_id, name as account_name, simple_name as simple_name, '' as manger_account_id, 10010 as media_id, '' as media_company_name, if(status in (0, 2), 'SUCCESS', 'FAIL') as auth_status, token as certificate, '' as media_auth_account, create_time as auth_time, -1 as agent_id, optimizer_id, -1 as app_id, create_by as auth_user_id, 0 as is_manger_account, 0 as is_deleted from sunrise.weibo_account"
        connection_check_timeout_sec = 100
        result_table_name = tb01
    }
    Jdbc {
        url = "jdbc:mysql://10.35.2.110:33016/sunrise?allowMultiQueries=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false&rewriteBatchedStatements=true&useSSL=false"
        user = "repl"
        password = "RePl#123"
        driver = "com.mysql.cj.jdbc.Driver"
        query = "select company_id AS company_id, CAST(account_id AS char) AS account_id, name as account_name, simple_name as simple_name, '' as manger_account_id, 10006 as media_id, '' as media_company_name, if(status in (0, 2), 'SUCCESS', 'FAIL') as auth_status, token as certificate, '' as media_auth_account, create_time as auth_time, -1 as agent_id, optimizer_id, -1 as app_id, create_by as auth_user_id, 0 as is_manger_account, 0 as is_deleted from sunrise.aiqiyi_account"
        connection_check_timeout_sec = 100
        result_table_name = tb02
    }
    Jdbc {
        url = "jdbc:mysql://10.35.2.110:33016/sunrise?allowMultiQueries=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false&rewriteBatchedStatements=true&useSSL=false"
        user = "repl"
        password = "RePl#123"
        driver = "com.mysql.cj.jdbc.Driver"
        query = "select company_id AS company_id, CAST(account_id AS char) AS account_id, account_name  as account_name, account_name  as simple_name, '' as manger_account_id, 10011  as media_id, '' as media_company_name, if(status in ('ENABLE', 'INITIALIZING'), 'SUCCESS', 'FAIL') as auth_status, token  as certificate, '' as media_auth_account, create_time as auth_time, -1 as agent_id, ifnull(optimizer_id, -1) optimizer_id, -1 as app_id, -1 as auth_user_id, 0 as is_manger_account, 0 as  is_deleted from sunrise.huya_account_temp"
        connection_check_timeout_sec = 100
        result_table_name = tb03
    }
    Jdbc {
        url = "jdbc:mysql://10.35.2.110:33016/sunrise?allowMultiQueries=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false&rewriteBatchedStatements=true&useSSL=false"
        user = "repl"
        password = "RePl#123"
        driver = "com.mysql.cj.jdbc.Driver"
        query = "select company_id AS company_id, CAST(account_id AS char) AS account_id, account_name  as account_name, simple_name as simple_name, '' as manger_account_id, 10012 as media_id, '' as media_company_name, if(status in (1), 'SUCCESS', 'FAIL') as auth_status, access_token  as certificate, '' as media_auth_account, account_detail.create_time  as auth_time, -1 as agent_id, optimizer_id, -1 as app_id, optimizer_id  as auth_user_id, 0 as is_manger_account, cast(is_delete AS SIGNED int) as is_deleted from sunrise.account_detail join sunrise.tokens on account_detail.token_id = tokens.id and tokens.media_type = account_detail.media_type where tokens.media_type = 22 and account_detail.media_type = 22"
        connection_check_timeout_sec = 100
        result_table_name = tb04
    }
    Jdbc {
        url = "jdbc:mysql://10.35.2.110:33016/sunrise?allowMultiQueries=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false&rewriteBatchedStatements=true&useSSL=false"
        user = "repl"
        password = "RePl#123"
        driver = "com.mysql.cj.jdbc.Driver"
        query = "select company_id AS company_id, CAST(account_id AS char) AS account_id, med_name  as account_name, simple_name  as simple_name, '' as manger_account_id, 10014 as media_id, med_company_name as media_company_name, if(auth_status in (0, 2) and med_status = 2, 'SUCCESS', 'FAIL') as auth_status, access_token as certificate, '' as media_auth_account, create_time  as auth_time, -1 as agent_id, optimizer_id, -1 as app_id, create_by as auth_user_id, 0 as is_manger_account, cast(is_deleted AS SIGNED int) is_deleted from sunrise.vivo_account"
        connection_check_timeout_sec = 100
        result_table_name = tb05
    }
    Jdbc {
        url = "jdbc:mysql://10.35.2.110:33016/sunrise?allowMultiQueries=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false&rewriteBatchedStatements=true&useSSL=false"
        user = "repl"
        password = "RePl#123"
        driver = "com.mysql.cj.jdbc.Driver"
        query = "select company_id AS company_id, CAST(account_id AS char) AS account_id, name as account_name, simple_name as simple_name, ''  as manger_account_id, 10015  as media_id, ''  as media_company_name, if(status in (0, 2), 'SUCCESS', 'FAIL')  as auth_status, JSON_OBJECT('secret_key', secret_key, 'sign_id', sign_id) as certificate, ''  as media_auth_account, create_time as auth_time, -1  as agent_id, optimizer_id, -1  as app_id, create_by  as auth_user_id, 0 as is_manger_account, 0  as  is_deleted from sunrise.xiaomi_account"
        connection_check_timeout_sec = 100
        result_table_name = tb06
    }
    Jdbc {
        url = "jdbc:mysql://10.35.2.110:33016/sunrise?allowMultiQueries=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false&rewriteBatchedStatements=true&useSSL=false"
        user = "repl"
        password = "RePl#123"
        driver = "com.mysql.cj.jdbc.Driver"
        query = "select cast(adv.company_id AS SIGNED) AS company_id, CAST(adv.third_party_id AS char) as account_id, adv.real_name as account_name, adv.name as simple_name, if(p.third_party_id is null, '', CAST(adv.third_party_id AS char)) as manger_account_id, if(adv.channel_type = 'FEED', 10005, 10004) AS media_id, CASE adv.media_type WHEN 1 THEN adv.tt_company_name WHEN 2 THEN adv.wx_mdm_name ELSE '' END as media_company_name, IF(adv.status > 0, 'SUCCESS', 'FAIL') AS auth_status, adv.access_token AS certificate, '' AS media_auth_account, adv.created_at as auth_time, -1 as agent_id, IFNULL(adv.optimizer, -1) as optimizer_id, -1 as app_id, IFNULL(adv.optimizer, -1) as auth_user_id, CAST(adv.majordomo AS SIGNED int) AS is_manger_account, 0 as is_deleted from sunrise.advertisers as adv left join sunrise.advertisers as p on adv.parent_id = p.id where (adv.media_type = 5 and adv.channel_type is not null)"
        connection_check_timeout_sec = 100
        result_table_name = tb07
    }
    Jdbc {
        url = "jdbc:mysql://10.35.2.110:33016/sunrise?allowMultiQueries=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false&rewriteBatchedStatements=true&useSSL=false"
        user = "repl"
        password = "RePl#123"
        driver = "com.mysql.cj.jdbc.Driver"
        query = "select cast(adv.company_id AS SIGNED) AS company_id, CAST(adv.third_party_id AS char) as account_id, adv.real_name as account_name, adv.name as simple_name, if(p.third_party_id is null, '', CAST(adv.third_party_id AS char)) as manger_account_id, CASE adv.media_type WHEN 1 THEN 10001 WHEN 2 THEN 10002 WHEN 4 THEN 10003 END AS media_id, CASE adv.media_type WHEN 1 THEN adv.tt_company_name WHEN 2 THEN adv.wx_mdm_name ELSE '' END as media_company_name, IF(adv.status >= 0, 'SUCCESS', 'FAIL') AS auth_status, adv.access_token AS certificate, ''  AS media_auth_account, adv.created_at as auth_time, -1  as agent_id, IFNULL(adv.optimizer,-1) as optimizer_id, -1  as app_id, IFNULL(adv.optimizer,-1) as auth_user_id, CAST(adv.majordomo as SIGNED int) AS is_manger_account, 0 as is_deleted from sunrise.advertisers as adv left join sunrise.advertisers as p on adv.parent_id = p.id where adv.media_type in (1,2,4)"
        connection_check_timeout_sec = 100
        result_table_name = tb08
    }
    Jdbc {
        url = "jdbc:mysql://10.35.2.110:33016/sunrise?allowMultiQueries=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false&rewriteBatchedStatements=true&useSSL=false"
        user = "repl"
        password = "RePl#123"
        driver = "com.mysql.cj.jdbc.Driver"
        query = "select ba.company_id, cast(account_id as char) as account_id, IFNULL(name,'')  as account_name, IFNULL( simple_name,'') as simple_name, ''  as manger_account_id, 10007  as media_id, ''  as media_company_name, if(status in ('ENABLE', 'INITIALIZING'), 'SUCCESS', 'FAIL') as auth_status, JSON_OBJECT('token',ba.token,'apiKey', ba.appkey, 'apiId', bd.secret) as certificate, ''  as media_auth_account, ba.create_time as auth_time, -1  as agent_id, optimizer_id, -1  as app_id, ba.create_by as auth_user_id, 0 as is_manger_account, 0 as is_deleted FROM sunrise.bilibili_account as ba join sunrise.bilibili_developer as bd on ba.appkey = bd.appkey and ba.company_id = bd.company_id"
        connection_check_timeout_sec = 100
        result_table_name = tb09
    }

}

sink {
    Jdbc {
        url = "jdbc:mysql://10.35.2.110:33016/sunrise?allowMultiQueries=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false&rewriteBatchedStatements=true&useSSL=false"
        user = "repl"
        password = "RePl#123"
        driver = "com.mysql.cj.jdbc.Driver"
        source_table_name = ["tb00","tb01","tb02","tb03","tb04","tb05","tb06","tb07","tb08","tb09"]
        enable_upsert = true
        generate_sink_sql = true
        database = sunrise_v2
        table = ad_account_tmp
        primary_keys = ["company_id","account_id","media_id"]
    }
}
